<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>管理者サイト - お酒の情報管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { db, initAuth } from './firebase-config.js';

        // 認証状態の監視
        initAuth((user) => {
            const loginForm = document.getElementById('loginForm');
            const adminContent = document.getElementById('adminContent');
            const logoutButton = document.getElementById('logoutButton');

            if (user) {
                // ログイン済み
                loginForm.style.display = 'none';
                adminContent.style.display = 'block';
                logoutButton.style.display = 'block';
                loadPendingSubmissions();
            } else {
                // 未ログイン
                loginForm.style.display = 'block';
                adminContent.style.display = 'none';
                logoutButton.style.display = 'none';
            }
        });

        // ログインフォームの処理
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            try {
                await db.authenticateAdmin(email, password);
            } catch (error) {
                alert(error.message);
            }
        });

        // ログアウトボタンの処理
        document.getElementById('logoutButton').addEventListener('click', async () => {
            try {
                await db.logout();
            } catch (error) {
                alert(error.message);
            }
        });

        // 保留中の投稿を読み込む
        async function loadPendingSubmissions() {
            try {
                const submissions = await db.getPendingSubmissions();
                const submissionsList = document.getElementById('submissionsList');
                submissionsList.innerHTML = '';

                if (submissions.length === 0) {
                    submissionsList.innerHTML = '<p class="text-gray-500">保留中の投稿はありません</p>';
                    return;
                }

                submissions.forEach(submission => {
                    const submissionElement = createSubmissionElement(submission);
                    submissionsList.appendChild(submissionElement);
                });
            } catch (error) {
                console.error('Error loading submissions:', error);
                alert('投稿の読み込みに失敗しました');
            }
        }

        // 投稿要素の作成
        function createSubmissionElement(submission) {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg shadow-md p-6 mb-4';
            div.innerHTML = `
                <h3 class="text-xl font-bold mb-2">${submission.name}</h3>
                <p class="text-gray-600 mb-2">種類: ${submission.type}</p>
                <p class="text-gray-600 mb-2">説明: ${submission.description}</p>
                <p class="text-gray-600 mb-2">味の特徴: ${submission.taste.join(', ')}</p>
                <p class="text-gray-600 mb-2">価格帯: ${submission.priceRange}</p>
                <p class="text-gray-600 mb-2">アルコール度数: ${submission.alcoholContent}%</p>
                <p class="text-gray-600 mb-4">メーカー/産地: ${submission.origin}</p>
                <div class="mb-4">
                    <label for="imageUrl_${submission.id}" class="block text-sm font-medium text-gray-700">画像URL</label>
                    <input type="text" id="imageUrl_${submission.id}" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                           placeholder="https://example.com/image.jpg">
                </div>
                <div class="flex space-x-4">
                    <button onclick="approveSubmission('${submission.id}')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">承認</button>
                    <button onclick="rejectSubmission('${submission.id}')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">却下</button>
                </div>
            `;
            return div;
        }

        // 投稿の承認
        window.approveSubmission = async (submissionId) => {
            try {
                const imageUrl = document.getElementById(`imageUrl_${submissionId}`).value.trim();
                await db.approveSubmission(submissionId, imageUrl);
                alert('投稿を承認しました');
                loadPendingSubmissions();
            } catch (error) {
                alert(error.message);
            }
        };

        // 投稿の却下
        window.rejectSubmission = async (submissionId) => {
            if (confirm('この投稿を却下してもよろしいですか？')) {
                try {
                    await db.rejectSubmission(submissionId);
                    alert('投稿を却下しました');
                    loadPendingSubmissions();
                } catch (error) {
                    alert(error.message);
                }
            }
        };
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- ログインフォーム -->
        <div id="loginForm" class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">管理者ログイン</h2>
            <form class="space-y-4">
                <div>
                    <label for="adminEmail" class="block text-sm font-medium text-gray-700">メールアドレス</label>
                    <input type="email" id="adminEmail" name="email" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <div>
                    <label for="adminPassword" class="block text-sm font-medium text-gray-700">パスワード</label>
                    <input type="password" id="adminPassword" name="password" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <button type="submit"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    ログイン
                </button>
            </form>
        </div>

        <!-- 管理者コンテンツ -->
        <div id="adminContent" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">管理者パネル</h1>
                <button id="logoutButton"
                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                    ログアウト
                </button>
            </div>

            <!-- 保留中の投稿 -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">保留中の投稿</h2>
                <div id="submissionsList" class="space-y-4">
                    <!-- 投稿はJavaScriptで動的に追加 -->
                </div>
            </div>
        </div>
    </div>
</body>
</html> 