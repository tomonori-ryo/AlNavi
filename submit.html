<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>お酒の情報提供 - AlNavi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { config, initializeConfig } from './config.js';
        import { dataManager } from './data.js';

        // 設定の初期化
        if (!initializeConfig()) {
            alert('設定の初期化に失敗しました。管理者に連絡してください。');
        }

        // グローバル変数として設定
        window.config = config;
        window.dataManager = dataManager;
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-800 mb-8">お酒の情報提供</h1>

            <form id="submitForm" class="bg-white rounded-lg shadow-md p-6 space-y-6">
                <!-- お酒の名前 -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">お酒の名前</label>
                    <input type="text" id="name" name="name" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- お酒の種類 -->
                <div>
                    <label for="type" class="block text-sm font-medium text-gray-700">お酒の種類</label>
                    <select id="type" name="type" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">選択してください</option>
                        <option value="ビール">ビール</option>
                        <option value="ワイン">ワイン</option>
                        <option value="日本酒">日本酒</option>
                        <option value="ウイスキー">ウイスキー</option>
                        <option value="焼酎">焼酎</option>
                        <option value="その他">その他</option>
                    </select>
                </div>

                <!-- 説明 -->
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">説明</label>
                    <textarea id="description" name="description" rows="3" required
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                </div>

                <!-- 味の特徴 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">味の特徴</label>
                    <div class="grid grid-cols-2 gap-2">
                        <label class="inline-flex items-center" for="taste-sweet">
                            <input type="checkbox" id="taste-sweet" name="taste" value="甘口" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">甘口</span>
                        </label>
                        <label class="inline-flex items-center" for="taste-dry">
                            <input type="checkbox" id="taste-dry" name="taste" value="辛口" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">辛口</span>
                        </label>
                        <label class="inline-flex items-center" for="taste-fruity">
                            <input type="checkbox" id="taste-fruity" name="taste" value="フルーティー" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">フルーティー</span>
                        </label>
                        <label class="inline-flex items-center" for="taste-spicy">
                            <input type="checkbox" id="taste-spicy" name="taste" value="スパイシー" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">スパイシー</span>
                        </label>
                        <label class="inline-flex items-center" for="taste-smoky">
                            <input type="checkbox" id="taste-smoky" name="taste" value="スモーキー" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">スモーキー</span>
                        </label>
                        <label class="inline-flex items-center" for="taste-other">
                            <input type="checkbox" id="taste-other" name="taste" value="その他" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">その他</span>
                        </label>
                    </div>
                </div>

                <!-- 価格帯 -->
                <div>
                    <label for="priceRange" class="block text-sm font-medium text-gray-700">価格帯</label>
                    <select id="priceRange" name="priceRange" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">選択してください</option>
                        <option value="1,000円未満">1,000円未満</option>
                        <option value="1,000円〜3,000円">1,000円〜3,000円</option>
                        <option value="3,000円〜5,000円">3,000円〜5,000円</option>
                        <option value="5,000円〜10,000円">5,000円〜10,000円</option>
                        <option value="10,000円以上">10,000円以上</option>
                    </select>
                </div>

                <!-- アルコール度数 -->
                <div>
                    <label for="alcoholContent" class="block text-sm font-medium text-gray-700">アルコール度数 (%)</label>
                    <input type="number" id="alcoholContent" name="alcoholContent" min="0" max="100" step="0.1" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- 製造元・産地 -->
                <div>
                    <label for="origin" class="block text-sm font-medium text-gray-700">製造元・産地</label>
                    <input type="text" id="origin" name="origin"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- 画像 -->
                <div>
                    <label for="image" class="block text-sm font-medium text-gray-700">画像</label>
                    <input type="file" id="image" name="image" accept="image/*"
                           class="mt-1 block w-full text-sm text-gray-500
                                  file:mr-4 file:py-2 file:px-4
                                  file:rounded-md file:border-0
                                  file:text-sm file:font-medium
                                  file:bg-blue-50 file:text-blue-700
                                  hover:file:bg-blue-100">
                </div>

                <!-- 送信ボタン -->
                <div>
                    <button type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        情報を提供する
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // フォーム送信の処理
        document.getElementById('submitForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            try {
                // フォームデータの取得
                const formData = {
                    name: document.getElementById('name').value,
                    type: document.getElementById('type').value,
                    description: document.getElementById('description').value,
                    taste: Array.from(document.querySelectorAll('input[name="taste"]:checked')).map(cb => cb.value),
                    priceRange: document.getElementById('priceRange').value,
                    alcoholContent: parseFloat(document.getElementById('alcoholContent').value),
                    origin: document.getElementById('origin').value || ''
                };

                // 画像のアップロード
                const imageFile = document.getElementById('image').files[0];
                if (imageFile) {
                    const imageData = new FormData();
                    imageData.append('image', imageFile);

                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${config.imgbb.apiKey}`, {
                        method: 'POST',
                        body: imageData
                    });

                    const result = await response.json();
                    if (result.success) {
                        formData.imageUrl = result.data.url;
                    }
                }

                // 投稿の追加
                await dataManager.addSubmission(formData);

                // 成功メッセージを表示
                alert(config.messages.success.submit);
                window.location.href = 'index.html';

            } catch (error) {
                console.error('投稿エラー:', error);
                alert(error.message);
            }
        });
    </script>
</body>
</html> 